# Gonka: –æ—á–∏—Å—Ç–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ –≤—Ä–µ–º–µ–Ω–Ω—É—é –Ω–æ–¥—É

> **[English version](README.md)** | **–†—É—Å—Å–∫–∞—è –≤–µ—Ä—Å–∏—è**

## üìã –û–±–∑–æ—Ä

–≠—Ç–æ—Ç –Ω–∞–±–æ—Ä –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ—á–∏—Å—Ç–∏—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –≤–∞—à–µ–π –Ω–æ–¥—ã Gonka —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º –≤—Ä–µ–º–µ–Ω–µ–º –ø—Ä–æ—Å—Ç–æ—è, –∏—Å–ø–æ–ª—å–∑—É—è –≤—Ä–µ–º–µ–Ω–Ω—É—é –Ω–æ–¥—É.

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

–°–º. [QUICK_START.ru.md](QUICK_START.ru.md) –¥–ª—è –∫—Ä–∞—Ç–∫–æ–≥–æ –æ–±–∑–æ—Ä–∞ (—Ç–∞–∫–∂–µ –¥–æ—Å—Ç—É–ø–Ω–∞ [–∞–Ω–≥–ª–∏–π—Å–∫–∞—è –≤–µ—Ä—Å–∏—è](QUICK_START.md)).

## üìñ –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–°–º. [TEMP_NODE_SYNC.ru.md](TEMP_NODE_SYNC.ru.md) –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ (—Ç–∞–∫–∂–µ –¥–æ—Å—Ç—É–ø–Ω–∞ [–∞–Ω–≥–ª–∏–π—Å–∫–∞—è –≤–µ—Ä—Å–∏—è](TEMP_NODE_SYNC.md)).

## üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- –†–∞–±–æ—Ç–∞—é—â–∞—è –Ω–æ–¥–∞ Gonka –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `gonka/deploy/join`
- –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ Docker –∏ Docker Compose
- –î–æ—Å—Ç—É–ø–Ω—ã–µ –ø–æ—Ä—Ç—ã 15001 (P2P) –∏ 26667 (RPC) –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω–æ–π –Ω–æ–¥—ã
- –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π `jq` –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON
- –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π `yq` –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ YAML (—Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–ª—è start-temp.sh)

### –ü—Ä–µ–¥–ø–æ–ª–æ–∂–µ–Ω–∏—è (—Ç—Ä–µ–±—É–µ–º–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞)

–°–∫—Ä–∏–ø—Ç—ã –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞—é—Ç, —á—Ç–æ –≤—ã –∑–∞–ø—É—Å–∫–∞–µ—Ç–µ –∏—Ö –¥–ª—è –Ω–æ–¥—ã –≤ `gonka/deploy/join` –∏ —á—Ç–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç docker-—Ç–æ–º–∞–º:

- `.inference:/root/.inference` (–¥–ª—è `node` –∏ `api`)
- `.tmkms:/root/.tmkms` (–¥–ª—è `tmkms`)

–¢–∞–∫–∂–µ –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è, —á—Ç–æ –≤ `docker-compose.yml` –≤ `gonka/deploy/join` –∑–∞–¥–∞–Ω—ã —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–º–µ–Ω–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤:

- `node` (–æ—Å–Ω–æ–≤–Ω–∞—è –Ω–æ–¥–∞)
- `tmkms` (KMS)

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞

```bash
# 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å yq, –µ—Å–ª–∏ –µ—â–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
sudo wget https://github.com/mikefarah/yq/releases/latest/download/yq_linux_amd64 -O /usr/bin/yq && sudo chmod +x /usr/bin/yq

# 2. –ü–µ—Ä–µ–π—Ç–∏ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è Gonka
cd gonka/deploy/join

# 3. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —ç—Ç–æ—Ç —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone https://github.com/jemeraldo/temp-node.git temp-node

# 4. –°–¥–µ–ª–∞—Ç—å —Å–∫—Ä–∏–ø—Ç—ã –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º–∏
chmod +x temp-node/*.sh

# 5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É—Å—Ç–∞–Ω–æ–≤–∫—É
ls -la temp-node/
```

## üéØ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ë—ã—Å—Ç—Ä–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è (—Å –ª–æ–∫–∞–ª—å–Ω—ã–º–∏ —Å–Ω—ç–ø—à–æ—Ç–∞–º–∏)

**Downtime –æ—Å–Ω–æ–≤–Ω–æ–π –Ω–æ–¥—ã:** 2-10 –º–∏–Ω—É—Ç –Ω–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –ë–î  
**–í—Ä–µ–º—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:** 10-30 –º–∏–Ω—É—Ç –æ—Ç –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–Ω—ç–ø—à–æ—Ç–∞

```bash
cd gonka/deploy/join

sudo ./temp-node/start-temp.sh && \
./temp-node/wait-temp-sync.sh && \
sudo ./temp-node/swap-from-temp.sh
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: Zero-Downtime —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è (–∏–∑ —Å–µ—Ç–∏)

**Downtime –æ—Å–Ω–æ–≤–Ω–æ–π –Ω–æ–¥—ã:** –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥ (—Ç–æ–ª—å–∫–æ swap –∏–∑ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –Ω–æ–¥—ã)  
**–í—Ä–µ–º—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:** –ß–∞—Å—ã (–ø–æ–ª–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∏–∑ —Å–µ—Ç–∏)

```bash
cd gonka/deploy/join

sudo ./temp-node/start-temp.sh --from-scratch && \
./temp-node/wait-temp-sync.sh && \
sudo ./temp-node/swap-from-temp.sh
```

**–í–∞—Ä–∏–∞–Ω—Ç 2 —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è, –µ—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –≤—Ä–µ–º—è –Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é –∏–∑ —Å–µ—Ç–∏.**

## üóëÔ∏è –û—á–∏—Å—Ç–∫–∞

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ swap –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏:

```bash
# –£–¥–∞–ª–∏—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã
docker rm -f node-temp tmkms-temp
# –£–¥–∞–ª–∏—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
rm -rf .inference-temp .tmkms-temp docker-compose.temp.yml
# –£–¥–∞–ª–∏—Ç—å –±—ç–∫–∞–ø—ã (–∫–æ–≥–¥–∞ —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç!)
rm -rf .inference/data.bak .inference/wasm.bak
```

## üîÑ –û—Ç–∫–∞—Ç

–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫:

```bash
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –æ—Ç–∫–∞—Ç–∞
sudo ./temp-node/rollback-swap.sh

# –ò–ª–∏ –≤—Ä—É—á–Ω—É—é:
docker stop node
cd .inference
rm -rf data wasm
mv data.bak data
mv wasm.bak wasm
docker start node
```

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):

```bash
# –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
export HEIGHT_DIFF_THRESHOLD=5
export POLL_INTERVAL=5

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫—Ä–∏–ø—Ç –æ–∂–∏–¥–∞–Ω–∏—è
./temp-node/wait-temp-sync.sh
```

## üìù –û–±–∑–æ—Ä —Å–∫—Ä–∏–ø—Ç–æ–≤

| –°–∫—Ä–∏–ø—Ç | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|----------|
| `start-temp.sh` | –ó–∞–ø—É—Å–∫ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –Ω–æ–¥—ã –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ |
| `wait-temp-sync.sh` | –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –Ω–æ–¥—ã |
| `swap-from-temp.sh` | –ó–∞–º–µ–Ω–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –æ—Å–Ω–æ–≤–Ω–æ–π –Ω–æ–¥—ã –Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ (—Ç–∞–∫–∂–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –æ—Å–Ω–æ–≤–Ω–æ–π `api`) |
| `rollback-swap.sh` | –û—Ç–∫–∞—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏ swap –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ |

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –ø—Ä–∏–º–µ—á–∞–Ω–∏—è

1. **PoC —Ñ–∞–∑–∞:** Swap –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –≤–æ –≤—Ä–µ–º—è –∞–∫—Ç–∏–≤–Ω–æ–π PoC —Ñ–∞–∑—ã
2. **–ë—ç–∫–∞–ø—ã:** –í—Å–µ–≥–¥–∞ —Å–æ–∑–¥–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–æ –≤—Ä–µ–º—è swap
3. **–ü—Ä–æ–≤–µ—Ä–∫–∞:** –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å –Ω–∞ —Ç–µ—Å—Ç–æ–≤–æ–π –Ω–æ–¥–µ —Å–Ω–∞—á–∞–ª–∞
4. **–ü–æ—Ä—Ç—ã:** –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ—Ä—Ç—ã –≤—Ä–µ–º–µ–Ω–Ω–æ–π –Ω–æ–¥—ã (15001, 26667) –¥–æ—Å—Ç—É–ø–Ω—ã

## üîß Troubleshooting

**–í—Ä–µ–º–µ–Ω–Ω–∞—è –Ω–æ–¥–∞ –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è:**
```bash
docker logs node-temp
```

**–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∑–∞—Å—Ç—Ä—è–ª–∞:**
```bash
curl http://127.0.0.1:26667/status | jq .result.sync_info
```

**Swap –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å PoC
curl http://127.0.0.1:8000/v1/epochs/latest | jq .is_confirmation_poc_active
```

## üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏—è

–ß—Ç–æ–±—ã –æ–±–Ω–æ–≤–∏—Ç—å —Å–∫—Ä–∏–ø—Ç—ã –¥–æ –ø–æ—Å–ª–µ–¥–Ω–µ–π –≤–µ—Ä—Å–∏–∏:

```bash
cd gonka/deploy/join/temp-node
git pull
```
